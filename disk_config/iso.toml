[customizations.installer.kickstart]
contents = """
%pre
#attempt to add the devicetree stuff naturally, we'll see if this works or fails

mkdir -p /boot/grub2
echo 'set devicetree="dtb/qcom/sc8280xp-lenovo-thinkpad-x13s.dtb"' >> /boot/grub2/user.cfg
%end
%post
bootc switch --mutate-in-place --transport registry ghcr.io/rinabella-gh/bootc-x13s:latest
bootupctl update
%end
"""

[customizations.installer.modules]
enable = [
  "org.fedoraproject.Anaconda.Modules.Storage"
]
disable = [
  "org.fedoraproject.Anaconda.Modules.Network",
  "org.fedoraproject.Anaconda.Modules.Security",
  "org.fedoraproject.Anaconda.Modules.Services",
  "org.fedoraproject.Anaconda.Modules.Users",
  "org.fedoraproject.Anaconda.Modules.Subscription",
  "org.fedoraproject.Anaconda.Modules.Timezone"
]

[[customizations.files]]
path = "/etc/default/grub"
mode = "0644"
user = "root"
group = "root"
data = """
GRUB_DEFAULT_DTB = qcom/x13s.dtb
GRUB_TIMEOUT = 1000
"""

